
<!DOCTYPE = html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Shoehorn Circle - Game Finder</title>
        <link rel="stylesheet" href="/css/play.css">
    </head>
    <body>
        <h1>Play</h1>

        <div id="player_area">
        </div>
        <script src="/js/qfetch.js"></script>
        <script src="/js/cookie.js"></script>
        <script src="/js/player.js"></script>
        <script>




player_name = cookie_mod.get("user_name");
game_actions = [];
players = [];

let rooter = {};

rooter.drop_cards = function(cds){
    
    let reqs = cds.map(c => {return {DropCard:c}});

    let dt = { from:game_actions.length,
                requests:reqs}; 

    qfetch_mod.jsonPost("/request_actions",dt,processActions);
}


function processActions(acts){
    for ( p in acts) {
        let ac = acts[p];
        for (q in ac) {
            let ac_do = ac[q];
            let pl = [];
            switch(q){
                case "AddPlayer":
                    players.push(player_mod.newPlayer(ac_do,document.getElementById("player_area"),rooter));
                break;
                case "PlayerDraw":
                    pl = players[ac_do[0]];
                    pl.addCard(ac_do[1]);
                break;    
                case "DropCard":
                    pl = players[ac_do[0]];
                    pl.dropCard(ac_do[1]);
                    console.log("Card Drop Processed");
                break;
            }
        }
        game_actions.push(acts[p]);
    }

    for (p in players){
        players[p].hint();
    }
}


function getActions(){

    qfetch_mod.jsonPost("/game_after",game_actions.length,processActions);
}


window.onload = getActions;


        </script>


    </body>
</html>
