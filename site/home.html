<!DOCTYPE = html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Muppets</title>
    </head>
    <body>
        <h1>Join a Game</h1>

        <form id="f1">
            <input type="text" name="said"/>
            <input type="submit" value="Join Game"/>
        </form>
        <div id="gamelist">
        </div>

    <script>

function formdata(f){
    let res = {};
    for (p in f.children){
        elem = f.children[p];
        console.log(elem.nodeName);
        if (elem.nodeName !== "INPUT") continue;
        if (elem.type == "submit") continue;
        res[elem.name]=elem.value;
        console.log("V = "+elem.name + " "  + elem.value);
    }
    return res;
}

let f1 = document.getElementById("f1");
f1.onsubmit= function(e){

    data = formdata(f1);
    console.log(data);
    fetch("/join_game",{
        method:"POST",
        headers:{
            "Content-Type":"application/json"
        },
        body:JSON.stringify(data.said)
    }).then(response => response.json())
        .catch(e=>console.log("Hello Error:"+ e))
        .then(res=> showData(res));
    return false;
}

function showData(d){
    let gameList = document.getElementById("gamelist");
    gameList.innerHTML = "";
    for( p in d){
        let gm = d[p];
        let gbox = document.createElement("div"); 
        let nm = document.createTextNode(gm.name+":");
        gbox.appendChild(nm);

        for (q in gm.players){
            let pname = gm.players[q];
            let namenode= document.createTextNode(pname+",");
            gbox.appendChild(namenode);
        }

        gameList.appendChild(gbox);
    }
}


view_data = function(){
    fetch("/view_games",{
        method:"GET",
        headers:{
            "Content-Type":"application/json"
        },
    }).then(response => response.json())
        .catch(e=>console.log("View Error:"+ e))
        .then(res=> showData(res));
}

onload = view_data;
setInterval(view_data,5000);



    </script>


    </body>
</html>
